<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${mode} == 'edit' ? 'Modifier location' : 'Nouvelle location'">Form Location</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">

    <h2 th:text="${mode} == 'edit' ? 'Modifier une location' : 'CrÃ©er une location'"></h2>

    <!-- Model attendu: 'location', 'clients', 'voitures', 'mode' (edit/new) -->
    <form th:action="${mode} == 'edit' ? @{/locations/update} : @{/locations}"
          method="post" class="row g-3 mt-2">

        <!-- Date dÃ©but (fait partie de la clÃ©) -->
        <div class="col-md-3">
            <label class="form-label">Date dÃ©but</label>
            <input class="form-control" type="date" name="dateDebut"
                   th:value="${location != null} ? ${#temporals.format(location.locationPk.dateDebut,'yyyy-MM-dd')} : ${#temporals.format(dateDebut,'yyyy-MM-dd')}"
                   th:disabled="${mode} == 'edit'" required>
        </div>

        <div class="col-md-3">
            <label class="form-label">Date fin</label>
            <input class="form-control" type="date" name="dateFin"
                   th:value="${location != null} ? ${#temporals.format(location.dateFin,'yyyy-MM-dd')} : ${#temporals.format(dateFin,'yyyy-MM-dd')}" required>
        </div>

        <div class="col-md-3">
            <label class="form-label">Client</label>
            <select class="form-select" name="clientId" th:disabled="${mode} == 'edit'" required>
                <option th:each="c : ${clients}" th:value="${c.id}" th:text="${c.nom}"
                        th:selected="${location != null} ? ${location.client != null and c.id == location.client.id} : false"></option>
            </select>
        </div>

        <div class="col-md-3">
            <label class="form-label">Voiture</label>
            <select class="form-select" name="voitureId" th:disabled="${mode} == 'edit'" required>
                <option th:each="v : ${voitures}" th:value="${v.id}" th:text="${v.immatriculation}"
                        th:selected="${location != null} ? ${location.voiture != null and v.id == location.voiture.id} : false"></option>
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label">Statut</label>
            <select class="form-select" name="statut">
                <option th:selected="${location != null and location.statut == 'CONFIRME'}">CONFIRME</option>
                <option th:selected="${location != null and location.statut == 'EN_COURS'}">EN_COURS</option>
                <option th:selected="${location != null and location.statut == 'TERMINE'}">TERMINE</option>
                <option th:selected="${location != null and location.statut == 'ANNULE'}">ANNULE</option>
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label">Montant total</label>
            <input class="form-control" type="number" step="0.01" name="montantTotal"
                   th:value="${location != null} ? ${location.montantTotal} : ${montantTotal}" required>
        </div>

        <!-- Parties de la clÃ© composite en mode edit -->
        <input type="hidden" name="clientId" th:if="${mode} == 'edit'" th:value="${location.locationPk.clientId}">
        <input type="hidden" name="voitureId" th:if="${mode} == 'edit'" th:value="${location.locationPk.voitureId}">
        <input type="hidden" name="dateDebut" th:if="${mode} == 'edit'" th:value="${#temporals.format(location.locationPk.dateDebut,'yyyy-MM-dd')}">

        <div class="col-12">
            <button class="btn btn-primary" type="submit">ðŸ’¾ Enregistrer</button>
            <a class="btn btn-secondary" th:href="@{/locations}">Annuler</a>
        </div>
    </form>

</div>
</body>
</html>
